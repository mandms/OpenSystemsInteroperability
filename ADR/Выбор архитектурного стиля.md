# ADR - Выбор архитектурного стиля

Дата: 17.09.2024
Статус: Принято
## Контекст

При разработке приложения для обмена фотографиями, аналогичного Instagram, необходимо выбрать подходящую архитектуру для обеспечения высокой производительности, масштабируемости и надежности системы. Основная задача — создание высоконагруженной платформы, которая сможет обрабатывать большое количество запросов, поддерживать хранение и мгновенную доставку фото, а также обеспечивать взаимодействие пользователей через лайки и комментарии.

При этом учитывается, что приложение будет использовать **серверный подход**, обеспечивающий стабильную работу при высокой нагрузке и возможность внедрения надежных механизмов безопасности. Это решение позволит лучше контролировать распределение ресурсов, защиту данных и мониторинг системы.

**Поскольку проект - учебный, предполагается что в разработке приложения принимает участие полноценная команда с опытом разработки на Golang**

## Рассматриваемые варианты

- **Монолитная архитектура:**

	- Все компоненты приложения объединены в единую систему, что упрощает разработку и развертывание.
	- **Преимущества:** Простота управления и развертывания, единая кодовая база, быстрая реализация и отладка.
	- **Недостатки:** Ограниченная масштабируемость и гибкость, сложности с поддержкой и внесением изменений по мере роста проекта, возможность деградации производительности при увеличении нагрузки.

- Микросервисная архитектура
	- Приложение разделено на независимые сервисы, каждый из которых выполняет свою функцию, например, хранение фотографий, управление пользователями, обработка комментариев.
	- **Преимущества:** Независимое масштабирование и обновление сервисов, улучшенная отказоустойчивость, гибкость в разработке.
	- **Недостатки:** Более высокая сложность проектирования и управления, необходимость организации межсервисного взаимодействия, дополнительные накладные расходы на инфраструктуру и мониторинг.
## Решение

Выбрана Микросервисная архитектура.

## Обоснование

Были рассмотрены плюсы и минусы обоих подходов.

#### Плюсы микросервисного подхода:
- Масштабируемость: Каждый микросервис можно масштабировать независимо, что позволяет оптимизировать использование ресурсов.
- Гибкость: Изменения в одном микросервисе не влияют на другие, что упрощает внесение изменений и ускоряет разработку.
- Устойчивость к отказам: Отказ одного микросервиса не приводит к остановке всей системы.
#### Минусы микросервисного подхода:
- **Сложность разработки и управления:** Требуется организация взаимодействия между сервисами и управление их зависимостями.
- **Высокие накладные расходы:** Увеличение числа сервисов приводит к росту затрат на инфраструктуру, мониторинг и логирование.

#### Рассматриваемые альтернативы:
- Монолитная архитектура: Проста в разработке и развертывании, но сложна в масштабировании и поддержке. 
- **Трудности поддержки и внесения изменений:** В монолитной архитектуре изменения в одной части системы могут повлиять на другие, что увеличивает риски и сложность поддержки, особенно при росте функциональности и числа пользователей.
- **Уязвимость к отказам:** Проблема в одном модуле монолита может привести к сбою всей системы, что делает его менее устойчивым к отказам по сравнению с микросервисами.

  **Учитывая требования к приложению — обеспечение масштабируемости, гибкости и отказоустойчивости, — микросервисная архитектура является оптимальным выбором. Монолитный подход, хотя и проще в реализации на начальном этапе, не соответствует долгосрочным целям и требованиям проекта.**

## Последствия

Плюсы:
- Гибкость и масштабируемость: Возможность независимого масштабирования и развертывания отдельных сервисов.
- Разделение на микросервисы упрощает обновление и развитие отдельных частей системы.

Минусы:
- Увеличение сложности разработки и развертывания.


Риски:
- Возможные сложности с интеграцией и взаимодействием между микросервисами.
	-Возможные решения:
	- **Четко определенные контракты:** Разработка и документация интерфейсов для каждого микросервиса. Это поможет всем разработчикам следовать единому протоколу и облегчит интеграцию.
	- **Межсервисная коммуникация через асинхронные протоколы:** Использование асинхронных механизмов обмена сообщениями, такие как очереди сообщений, чтобы уменьшить зависимость сервисов друг от друга и снизить задержки при обмене данными.

- Увеличение сетевого трафика между микросервисами.  Возможное решения: 
	- **Кэширование данных:** Используйте кэширование на уровне сервисов для уменьшения количества повторных запросов. Применение кэша позволяет временно хранить результаты запросов и снижать нагрузку на сеть.


## Затронутые области

- Архитектура: Разработка архитектуры микросервисов.
- Разработка: Разработка каждого микросервиса как отдельного приложения.
- Инфраструктура (системы мониторинга, управление и масштабирование микросервисов).
- Развертывание: Автоматизация процесса развертывания микросервисов.

## История
Решения были приняты 17 сентября. Обсуждение касалось вопросов развертывании, масштабируемости и взаимодействия сервисов системы.

В итоге была выбрана микросервисная архитектура как наиболее подходящая для создания высоконагруженного продукта фотохостинга.